#!/bin/sh

if [[ "$1" = "up" ]]
then
    VOLUME=$(($(amixer sget PCM | grep -oEm 1 'Playback [[:digit:]]+ \[' | grep -oE '[[:digit:]]+') + 10))
fi

if [[ "$1" = "down" ]]
then
    VOLUME=$(($(amixer sget PCM | grep -oEm 1 'Playback [[:digit:]]+ \[' | grep -oE '[[:digit:]]+') - 10))
fi

amixer sset PCM $VOLUME

SCREEN=($(bspc query -T | grep '^\S.*\*$' | grep -o '[[:digit:]]*x[[:digit:]]*' | tr 'x' ' '))
MAX=$(amixer sget PCM | grep Limits | grep -o '[[:digit:]]*$')

echo "^pa(1;1)^r($((VOLUME * 256 / MAX))x2)" | \
    persist volume -t 3 \
    dzen2 -tw 256 -h 4 \
        -x $((SCREEN[0] * 50 / 100 - 128)) -y $((SCREEN[1] * 80 / 100)) \
        -bg '#1d1f21' -fg '#ffffff' -ta l
