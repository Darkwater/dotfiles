#!/bin/sh


api="http://status.novaember.com/image"
imageEncoding="png"
slopargs="--nokeyboard -c 1,0.68,0 -b 1"
maimargs="--hidecursor"
secret=$(cat ~/.nvsecret)

eval $(slop $slopargs)
[[ "$((W+H))" = "0" ]] && exit 2

path="/tmp/screen.$imageEncoding"
maim $maimargs -g "${W}x${H}+${X}+${Y}" "$path"

i=-20
while sleep 0.02s
do
    echo "^r($i)^r(20x2)"
    let i+=6
    [[ "$i" -gt "350" ]] && i=-20
done | dzen2 -ta l -w 300 -h 4 -x -312 -y -16 &
dzenpid=$!

curl -F secret="$secret" -F file=@"$path" "$api" | json 'return this.url' | tr -d '\n' | xclip
kill $dzenpid
notify-send "Screenshot uploaded"
